From a3559f9f6d74820d8f3600e86052f5973789d6c3 Mon Sep 17 00:00:00 2001
From: Huy Duong <huy.duong@ologn.tech>
Date: Tue, 10 Dec 2024 15:04:17 +0700
Subject: [PATCH] Support selecting boot partition

---
 arch/arm/mach-rockchip/fit.c | 7 ++++++-
 configs/rv1106_defconfig     | 2 +-
 2 files changed, 7 insertions(+), 2 deletions(-)

diff --git a/arch/arm/mach-rockchip/fit.c b/arch/arm/mach-rockchip/fit.c
index c15c9a4498..841b4d5d1f 100644
--- a/arch/arm/mach-rockchip/fit.c
+++ b/arch/arm/mach-rockchip/fit.c
@@ -142,10 +142,15 @@ static void *fit_get_blob(struct blk_desc *dev_desc,
 {
 	__maybe_unused int conf_noffset;
 	disk_partition_t part;
-	char *part_name = PART_BOOT;
+	char *part_name;
 	void *fit, *fdt;
 	int blk_num;
 
+	part_name = env_get("boot_partname");
+	if (!part_name) {
+		part_name = PART_BOOT;
+	}
+
 #ifndef CONFIG_ANDROID_AB
 	if (rockchip_get_boot_mode() == BOOT_MODE_RECOVERY)
 		part_name = PART_RECOVERY;
diff --git a/configs/rv1106_defconfig b/configs/rv1106_defconfig
index f56f5bc565..4c633f9d06 100644
--- a/configs/rv1106_defconfig
+++ b/configs/rv1106_defconfig
@@ -79,7 +79,7 @@ CONFIG_OF_LIVE=y
 CONFIG_OF_SPL_REMOVE_PROPS="interrupt-parent assigned-clocks assigned-clock-rates assigned-clock-parents"
 CONFIG_OF_U_BOOT_REMOVE_PROPS="interrupt-parent"
 CONFIG_ENVF=y
-CONFIG_ENVF_LIST="blkdevparts mtdparts sys_bootargs app reserved ipaddr serverip netmask gatewayip ethaddr"
+CONFIG_ENVF_LIST="blkdevparts mtdparts sys_bootargs app reserved ipaddr serverip netmask gatewayip ethaddr boot_partname"
 CONFIG_REGMAP=y
 CONFIG_SPL_REGMAP=y
 CONFIG_SYSCON=y
-- 
2.47.0

